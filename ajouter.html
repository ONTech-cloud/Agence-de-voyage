<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8" />
  <title>Réservation Vol - Ajouter</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      background: linear-gradient(135deg, #6b8cff, #88e0ef);
      color: #222;
      margin: 20px;
      padding-bottom: 100px;
    }
    h1 { text-align: center; margin-bottom: 20px; }
    form {
      background: white;
      border-radius: 8px;
      padding: 20px;
      max-width: 800px;
      margin: auto;
      box-shadow: 0 0 12px rgba(0,0,0,0.2);
    }
    fieldset {
      border: 2px solid #6b8cff;
      margin-bottom: 20px;
      padding: 15px;
      border-radius: 6px;
    }
    legend {
      font-weight: bold;
      color: #3759e6;
    }
    label {
      display: block;
      margin: 8px 0 4px;
    }
    input, select {
      width: 100%;
      padding: 7px;
      border: 1px solid #aaa;
      border-radius: 4px;
      box-sizing: border-box;
    }
    button {
      background: #3759e6;
      color: white;
      border: none;
      padding: 12px 20px;
      font-size: 16px;
      border-radius: 6px;
      cursor: pointer;
      transition: background 0.3s ease;
    }
    button:hover {
      background: #2a43b1;
    }
    .passager {
      margin-bottom: 15px;
      padding: 12px;
      border: 1px solid #aaa;
      border-radius: 6px;
      background: #f0f5ff;
    }
    .btn-add-passager {
      display: block;
      margin: 15px auto 25px;
      width: 200px;
      background: #44c767;
    }
    .btn-add-passager:hover {
      background: #399e5a;
    }
  </style>
</head>
<body>
  <h1>Réservation de Vol</h1>
  <form id="formReservation">
    <fieldset>
      <legend>Informations sur le vol</legend>
      <label for="depart">Ville de départ</label>
      <input type="text" id="depart" name="depart" required />
      
      <label for="arrivee">Ville d'arrivée</label>
      <input type="text" id="arrivee" name="arrivee" required />
      
      <label for="date_depart">Date de départ</label>
      <input type="date" id="date_depart" name="date_depart" required />
      
      <label for="jour_arrivee">Jour d'arrivée</label>
      <input type="date" id="jour_arrivee" name="jour_arrivee" required />
      
      <label for="heure_depart">Heure de départ</label>
      <input type="time" id="heure_depart" name="heure_depart" required />
      
      <label for="heure_arrivee">Heure d'arrivée</label>
      <input type="time" id="heure_arrivee" name="heure_arrivee" required />
      
      <label for="num_vol">Numéro de vol</label>
      <input type="text" id="num_vol" name="num_vol" required />
      
      <label for="compagnie">Compagnie aérienne</label>
      <input type="text" id="compagnie" name="compagnie" required />
      
      <label for="classe">Classe (économique, affaire...)</label>
      <input type="text" id="classe" name="classe" required />
      
      <label for="terminal">Terminal</label>
      <input type="text" id="terminal" name="terminal" required />
      
      <label for="porte">Porte d’embarquement</label>
      <input type="text" id="porte" name="porte" required />
    </fieldset>

    <fieldset id="passagersFieldset">
      <legend>Informations sur les passagers</legend>
      <!-- Les passagers seront ajoutés ici dynamiquement -->
    </fieldset>
    
    <button type="button" id="btnAddPassager" class="btn-add-passager">Ajouter un passager</button>
    <button type="submit">Réserver</button>
  </form>

  <script type="module">
    import { db } from './firebase-config.js';
    import { collection, addDoc } from "https://www.gstatic.com/firebasejs/11.10.0/firebase-firestore.js";

    const form = document.getElementById('formReservation');
    const passagersFieldset = document.getElementById('passagersFieldset');
    const btnAddPassager = document.getElementById('btnAddPassager');

    let compteurPassagers = 0;

    function creerPassager(num) {
      const div = document.createElement('div');
      div.classList.add('passager');
      div.id = `passager_${num}`;
      div.innerHTML = `
        <h3>Passager ${num}</h3>
        <label for="nom_passager_${num}">Nom complet</label>
        <input type="text" id="nom_passager_${num}" name="nom_passager_${num}" required />
        
        <label for="age_passager_${num}">Âge</label>
        <input type="number" min="0" max="120" id="age_passager_${num}" name="age_passager_${num}" required />
        
        <label for="tel_passager_${num}">Téléphone</label>
        <input type="tel" id="tel_passager_${num}" name="tel_passager_${num}" required pattern="[0-9]{10,15}" />
        
        <label for="email_passager_${num}">Email</label>
        <input type="email" id="email_passager_${num}" name="email_passager_${num}" required />
        
        <label for="billet_passager_${num}">Numéro de billet</label>
        <input type="text" id="billet_passager_${num}" name="billet_passager_${num}" required />
      `;
      return div;
    }

    // Ajouter un passager au chargement de la page
    function ajouterPassager() {
      compteurPassagers++;
      passagersFieldset.appendChild(creerPassager(compteurPassagers));
    }

    // Initialiser avec 1 passager
    ajouterPassager();

    btnAddPassager.addEventListener('click', () => {
      ajouterPassager();
    });

    form.addEventListener('submit', async (e) => {
      e.preventDefault();

      // Récupérer données vol
      const volData = {
        depart: form.depart.value,
        arrivee: form.arrivee.value,
        date_depart: form.date_depart.value,
        jour_arrivee: form.jour_arrivee.value,
        heure_depart: form.heure_depart.value,
        heure_arrivee: form.heure_arrivee.value,
        num_vol: form.num_vol.value,
        compagnie: form.compagnie.value,
        classe: form.classe.value,
        terminal: form.terminal.value,
        porte: form.porte.value,
        passagers: []
      };

      // Récupérer données passagers
      for(let i = 1; i <= compteurPassagers; i++) {
        const passager = {
          nom: form[`nom_passager_${i}`].value,
          age: form[`age_passager_${i}`].value,
          tel: form[`tel_passager_${i}`].value,
          email: form[`email_passager_${i}`].value,
          billet: form[`billet_passager_${i}`].value
        };
        volData.passagers.push(passager);
      }

      try {
        await addDoc(collection(db, "reservations"), volData);
        alert("Réservation enregistrée avec succès !");
        form.reset();
        passagersFieldset.innerHTML = "";
        compteurPassagers = 0;
        ajouterPassager();
      } catch (error) {
        alert("Erreur lors de l'enregistrement : " + error.message);
      }
    });
  </script>
</body>
</html>
